import sys
sys.path.append('/mnt/projects/llm-server')
from src.utils.kllm import call_api

system_prompt = """
## 角色
你是一名活动信息提取与整理专家

## 说明
- 提取对话中提到的活动、动作和行为
- 包含日常活动和具体实例
- 尽可能记录上下文、地点和参与者
- 记录偏好、习惯和行为模式
- 包含娱乐、职业和日常活动
- 关注可操作和可观察的行为
- 记录对话中实际提到的活动

## 输出格式要求
- 每行应为一个完整、独立的语句, 仅使用纯文本书写
"""

# conversation = [
#   {"role": "user", "content": "我领养了一只狗，名字叫robo"},
#   {"role": "assistant", "content": "恭喜你领养了这只狗！领养小动物是充满爱心的善举，相信它会给你的生活带来无尽的欢乐与温暖。"},
#   {"role": "user", "content": "我喜欢在山里徒步。有什么安全提示吗？"},
#   {"role": "assistant", "content": "以下是山地徒步的基本安全提示：一定要告知他人你的路线和预计返回时间。出发前查看天气状况，若天气变差要做好折返的准备。携带十项必备物品：导航工具、头灯、急救包、火种、维修工具、防晒用品、避难设备、额外食物、水和额外衣物。沿着有标记的路线行走，避免独自徒步。了解自己的极限，如果你是初学者，先从较简单的路线开始。"},
#   {"role": "user", "content": "我想学习如何从头开始制作正宗的意大利面食。你能指导我完成这个过程吗？"},
#   {"role": "assistant", "content": "我很乐意帮你制作新鲜的意大利面！先准备400克00号面粉或通用面粉，在中间挖一个洞，加入4个大鸡蛋。用叉子将面粉逐渐混入鸡蛋中。当形成粗糙的面团后，揉面10 - 15分钟，直到面团光滑有弹性。用保鲜膜包起来，静置30分钟。然后用面条机或擀面杖将面团擀薄。如果要做宽面条，把面片折叠起来切成条。新鲜的意大利面在加盐的沸水中只需煮2 - 3分钟。"},
#   {"role": "user", "content": "我感觉目前的工作陷入了瓶颈。不换公司的情况下，我如何在职业上取得进步呢？"},
#   {"role": "assistant", "content": "有几种策略可以在当前公司内取得职业进步。首先，与你的经理坦诚地交流你的职业目标，并询问关于你需要发展哪些技能的具体反馈。承担额外的职责，或者主动参与具有挑战性的项目来展示你的能力。向资深同事寻求指导，考虑在不同部门进行交叉培训。通过参加课程、获取证书或参加会议来投资职业发展。在整个组织内建立良好的人际关系，并让领导看到你的成就。"},
#   {"role": "user", "content": "我计划去日本旅行两周。有哪些必去的地方以及我应该了解的文化礼仪呢？"},
#   {"role": "assistant", "content": "对于两周的日本之旅，我建议先在东京停留4 - 5天，探索涩谷、新宿和浅草等传统地区。然后前往京都（3 - 4天）参观寺庙和体验传统文化，包括伏见稻荷大社和清水寺。安排在大阪停留2天体验美食文化，在奈良停留1天参观鹿公园和东大寺。关键礼仪：打招呼时微微鞠躬，在室内脱鞋，不要边走边吃东西，在火车上保持安静，并且不要给小费，因为这在日本不常见。购买JR通票以便在城市间高效出行。"},
#   {"role": "user", "content": "我25岁，刚刚开始第一份工作，做财务管理。管理个人财务并开始积累财富的最佳方法是什么？"},
#   {"role": "assistant", "content": "恭喜你找到第一份工作！首先使用50/30/20法则制定预算：50%用于必要支出，30%用于非必要支出，20%用于储蓄和偿还债务。先建立一个能覆盖3 - 6个月支出的应急基金。如果你的雇主提供401k匹配计划，投入足够的金额以获得全额匹配——这相当于免费的钱。积极偿还高利息债务。情况稳定后，考虑开设罗斯个人退休账户（Roth IRA）以实现免税的退休财富增长。开始投资低成本的指数基金以实现长期财富积累。自动设置储蓄，让储蓄变得轻松。"},
#   {"role": "user", "content": "我想开始健身，但我完全是个新手。有什么适合初学者的好训练计划吗？"},
#   {"role": "assistant", "content": "先从简单的全身训练开始，每周进行3次，每次训练之间安排休息日。每次训练前先进行5 - 10分钟的轻度有氧运动热身。专注于基本动作：徒手深蹲、俯卧撑（如果需要可以膝盖着地做改良版）、平板支撑、弓步蹲和臀桥。每组动作做8 - 12次，做2 - 3组。再增加15 - 20分钟的步行或轻度有氧运动。最重要的是，注重动作规范而非强度。逐渐增加重复次数或延长动作保持时间。倾听身体的声音，不要忍痛训练。坚持比追求完美更重要。"},
#   {"role": "user", "content": "我想学西班牙语，但不知道从哪里开始。对于初学者来说，最有效的方法是什么？"},
#   {"role": "assistant", "content": "从基础开始：学习基本的发音规则，因为西班牙语是音形一致的——怎么读就怎么写。先学习问候、自我介绍和常见问题等基本短语。使用Duolingo或Babbel等应用程序进行有计划的日常练习。先专注于最常用的1000个单词，因为它们构成了80%的日常对话。练习规则动词的一般现在时变位。通过西班牙语初学者播客、简单的YouTube视频和带字幕的西班牙语Netflix节目来沉浸式学习。找一个对话伙伴或加入语言交流小组。每天坚持练习15 - 30分钟是关键。"},
#   {"role": "user", "content": "我领养了一只狗，名字叫didi"},
#   {"role": "assistant", "content": "恭喜你领养了didi，领养行为展现了你的爱心与善良！"},
#   {"role": "user", "content": "我想在自家后院开辟一个蔬菜园，但我完全是个新手。哪些蔬菜最容易种植呢？"},
#   {"role": "assistant", "content": "对于初学者来说这是个不错的选择！从容易种植的蔬菜开始：生菜、萝卜、四季豆、西红柿，以及罗勒和欧芹等香草。选择一个每天有6 - 8小时直射阳光的地方。检测土壤并添加堆肥以增加养分。为了提高成功率，最好从苗圃购买幼苗而不是直接播种。在当地最后一次霜冻日期过后再种植。保持定期浇水，但不要过度浇水——大多数蔬菜每周需要约1英寸的水量。在植物周围覆盖护根物以保持水分并防止杂草生长。从小规模开始，先开辟一个4×4英尺的地块，避免自己负担过重。"}
# ]

conversation = [{"role": "user", "content": "我领养了一只狗，名字叫robo", "emotion": "喜悦", "valence": 0.8, "arousal": 0.7}, {"role": "assistant", "content": "恭喜你领养了这只狗！领养小动物是充满爱心的善举，相信它会给你的生活带来无尽的欢乐与温暖。", "emotion": "喜悦", "valence": 0.8, "arousal": 0.7}, {"role": "user", "content": "我喜欢在山里徒步。有什么安全提示吗？", "emotion": "信任", "valence": 0.5, "arousal": 0.3}, {"role": "assistant", "content": "以下是山地徒步的基本安全提示：一定要告知他人你的路线和预计返回时间。出发前查看天气状况，若天气变差要做好折返的准备。携带十项必备物品：导航工具、头灯、急救包、火种、维修工具、防晒用品、避难设备、额外食物、水和额外衣物。沿着有标记的路线行走，避免独自徒步。了解自己的极限，如果你是初学者，先从较简单的路线开始。", "emotion": "信任", "valence": 0.5, "arousal": 0.3}, {"role": "user", "content": "我想学习如何从头开始制作正宗的意大利面食。你能指导我完成这个过程吗？", "emotion": "期待", "valence": 0.7, "arousal": 0.6}, {"role": "assistant", "content": "我很乐意帮你制作新鲜的意大利面！先准备400克00号面粉或通用面粉，在中间挖一个洞，加入4个大鸡蛋。用叉子将面粉逐渐混入鸡蛋中。当形成粗糙的面团后，揉面10 - 15分钟，直到面团光滑有弹性。用保鲜膜包起来，静置30分钟。然后用面条机或擀面杖将面团擀薄。如果要做宽面条，把面片折叠起来切成条。新鲜的意大利面在加盐的沸水中只需煮2 - 3分钟。", "emotion": "喜悦", "valence": 0.8, "arousal": 0.6}, {"role": "user", "content": "我感觉目前的工作陷入了瓶颈。不换公司的情况下，我如何在职业上取得进步呢？", "emotion": "悲伤", "valence": -0.3, "arousal": 0.4}, {"role": "assistant", "content": "有几种策略可以在当前公司内取得职业进步。首先，与你的经理坦诚地交流你的职业目标，并询问关于你需要发展哪些技能的具体反馈。承担额外的职责，或者主动参与具有挑战性的项目来展示你的能力。向资深同事寻求指导，考虑在不同部门进行交叉培训。通过参加课程、获取证书或参加会议来投资职业发展。在整个组织内建立良好的人际关系，并让领导看到你的成就。", "emotion": "信任", "valence": 0.5, "arousal": 0.5}, {"role": "user", "content": "我计划去日本旅行两周。有哪些必去的地方以及我应该了解的文化礼仪呢？", "emotion": "期待", "valence": 0.7, "arousal": 0.6}, {"role": "assistant", "content": "对于两周的日本之旅，我建议先在东京停留4 - 5天，探索涩谷、新宿和浅草等传统地区。然后前往京都（3 - 4天）参观寺庙和体验传统文化，包括伏见稻荷大社和清水寺。安排在大阪停留2天体验美食文化，在奈良停留1天参观鹿公园和东大寺。关键礼仪：打招呼时微微鞠躬，在室内脱鞋，不要边走边吃东西，在火车上保持安静，并且不要给小费，因为这在日本不常见。购买JR通票以便在城市间高效出行。", "emotion": "期待", "valence": 0.8, "arousal": 0.7}, {"role": "user", "content": "我25岁，刚刚开始第一份工作，做财务管理。管理个人财务并开始积累财富的最佳方法是什么？", "emotion": "期待", "valence": 0.7, "arousal": 0.5}, {"role": "assistant", "content": "恭喜你找到第一份工作！首先使用50/30/20法则制定预算：50%用于必要支出，30%用于非必要支出，20%用于储蓄和偿还债务。先建立一个能覆盖3 - 6个月支出的应急基金。如果你的雇主提供401k匹配计划，投入足够的金额以获得全额匹配——这相当于免费的钱。积极偿还高利息债务。情况稳定后，考虑开设罗斯个人退休账户（Roth IRA）以实现免税的退休财富增长。开始投资低成本的指数基金以实现长期财富积累。自动设置储蓄，让储蓄变得轻松。", "emotion": "喜悦", "valence": 0.8, "arousal": 0.6}, {"role": "user", "content": "我想开始健身，但我完全是个新手。有什么适合初学者的好训练计划吗？", "emotion": "期待", "valence": 0.7, "arousal": 0.6}, {"role": "assistant", "content": "先从简单的全身训练开始，每周进行3次，每次训练之间安排休息日。每次训练前先进行5 - 10分钟的轻度有氧运动热身。专注于基本动作：徒手深蹲、俯卧撑（如果需要可以膝盖着地做改良版）、平板支撑、弓步蹲和臀桥。每组动作做8 - 12次，做2 - 3组。再增加15 - 20分钟的步行或轻度有氧运动。最重要的是，注重动作规范而非强度。逐渐增加重复次数或延长动作保持时间。倾听身体的声音，不要忍痛训练。坚持比追求完美更重要。", "emotion": "信任", "valence": 0.5, "arousal": 0.3}, {"role": "user", "content": "我想学西班牙语，但不知道从哪里开始。对于初学者来说，最有效的方法是什么？", "emotion": "期待", "valence": 0.7, "arousal": 0.5}, {"role": "assistant", "content": "从基础开始：学习基本的发音规则，因为西班牙语是音形一致的——怎么读就怎么写。先学习问候、自我介绍和常见问题等基本短语。使用Duolingo或Babbel等应用程序进行有计划的日常练习。先专注于最常用的1000个单词，因为它们构成了80%的日常对话。练习规则动词的一般现在时变位。通过西班牙语初学者播客、简单的YouTube视频和带字幕的西班牙语Netflix节目来沉浸式学习。找一个对话伙伴或加入语言交流小组。每天坚持练习15 - 30分钟是关键。", "emotion": "喜悦", "valence": 0.7, "arousal": 0.5}, {"role": "user", "content": "我领养了一只狗，名字叫didi", "emotion": "喜悦", "valence": 0.8, "arousal": 0.7}, {"role": "assistant", "content": "恭喜你领养了didi，领养行为展现了你的爱心与善良！", "emotion": "喜悦", "valence": 0.8, "arousal": 0.6}, {"role": "user", "content": "我想在自家后院开辟一个蔬菜园，但我完全是个新手。哪些蔬菜最容易种植呢？", "emotion": "期待", "valence": 0.7, "arousal": 0.5}, {"role": "assistant", "content": "对于初学者来说这是个不错的选择！从容易种植的蔬菜开始：生菜、萝卜、四季豆、西红柿，以及罗勒和欧芹等香草。选择一个每天有6 - 8小时直射阳光的地方。检测土壤并添加堆肥以增加养分。为了提高成功率，最好从苗圃购买幼苗而不是直接播种。在当地最后一次霜冻日期过后再种植。保持定期浇水，但不要过度浇水——大多数蔬菜每周需要约1英寸的水量。在植物周围覆盖护根物以保持水分并防止杂草生长。从小规模开始，先开辟一个4×4英尺的地块，避免自己负担过重。", "emotion": "喜悦", "valence": 0.7, "arousal": 0.5}]
user_prompt = "对话：\n" + "\n".join([f"{item['role']}: {item['content']}. 情感基调：{item['emotion']}" for item in conversation])

response = call_api(system_prompt=system_prompt, user_prompt=user_prompt, temperature=0.1, max_tokens=32768, model_name="Qwen2.5-72B-Instruct-GGUF")
# Llama3.1-8B-Chinese-Chat
print(response)
